{% extends '_layouts/layout_main' %}

{% set body_class = 'page-research' %}
{% set title = "Research - ixLab" %}

{% macro createResearchCards(project) %}
  <div class="uk-margin-medium-bottom uk-card-body">
    <a href=" {{ project.url }}">
      <div>
        {% set image = project.researchFeatureImage.one() ?? null %}
        {% if image and image.kind == "image" %}
          <img class="uk-align-center uk-margin-remove-bottom" data-src="../../{{ image.getUrl('thumbLSquare') }}" alt="Project image" width="{{ image.getWidth('thumbLSquare') }}" height="{{ image.getHeight('thumbLSquare') }}" uk-img>
        {% else %}
          <img class="uk-align-center uk-margin-remove-bottom" src="http://via.placeholder.com/800x500?text=Project" alt="placeholder" uk-img>
        {% endif %}
      </div>
      <h5 class="uk-margin-remove-bottom uk-margin-remove-top uk-text-center">{{ project.title }}</h5>
    </a>
  </div> <!-- end of card -->
{% endmacro %}


{% block content %}

<div class="uk-container">

  <h1 class="uk-margin-medium-top uk-margin-medium-bottom uk-text-center uk-heading-medium">
    Featured Research
  </h1>
  <div uk-grid>
    <div class="uk-width-1-4@m uk-align-right uk-margin-small-right" uk-grid>
      <h4 class="uk-flex-right uk-text-right"> Research Themes </h4>
      <ul class="uk-subnav uk-subnav-pill uk-flex-right uk-margin-small-top">
        {% set query = craft.categories.group('researchTheme') %}
        {% set researchThemes = query.all() %}
        {% for theme in researchThemes %}
          {% set entriesInTheme = craft.entries.section('research').relatedTo(theme) %}
          {% if entriesInTheme|length > 0 %}
            {% if theme.title == category.title %}
              <li class="uk-active"><a href="{{ theme.url }}">{{ theme.title }}</a></li>
            {% else %}
              <li><a href="{{ theme.url }}">{{ theme.title }}</a></li>
            {% endif %}
          {% endif %}
        {% endfor %}
      </ul>
    </div><!-- left column -->
    <div class="uk-width-3-4@m uk-grid-large uk-child-width-1-3" uk-grid>
      {% set projectEntries = craft.entries.section('research').relatedTo(category).all() %}
      {% for project in projectEntries %}
        {{ _self.createResearchCards(project) }}
      {% endfor %}
    </div>
  </div> <!-- end of grid -->
</div> <!-- end of container -->

{% endblock %}